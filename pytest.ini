"""
Configuration for pytest.
"""

import os
import sys
import django
from pathlib import Path

# Add project root to path
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))

# Configure Django settings
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings.base')
os.environ['DATABASE_URL'] = 'postgresql://postgres:postgres@localhost:5432/test_db'
os.environ['REDIS_URL'] = 'redis://localhost:6379/1'
os.environ['OPENAI_API_KEY'] = 'test-key'
os.environ['SECRET_KEY'] = 'test-secret-key'

django.setup()


def pytest_configure(config):
    """Configure pytest."""
    import django
    from django.conf import settings
    
    settings.DEBUG = False
    settings.CELERY_TASK_ALWAYS_EAGER = True
    settings.CELERY_TASK_EAGER_PROPAGATES = True
