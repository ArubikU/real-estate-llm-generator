import { PropertyData } from '../types';

interface SidebarProps {
  properties: PropertyData[];
  onSelectProperty: (id: string) => void;
  onRefresh: () => void;
  onClearAll: () => void;
}

export default function Sidebar({ properties, onSelectProperty, onRefresh, onClearAll }: SidebarProps) {
  // Group properties by category
  const groupedByCategory = properties.reduce((acc, prop) => {
    const category = getCategoryFromUrl(prop.source_url || '');
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(prop);
    return acc;
  }, {} as Record<string, PropertyData[]>);

  return (\n    <div className=\"w-80 bg-white shadow-xl flex flex-col h-screen sticky top-0\">\n      <div className=\"p-4 border-b\">\n        <h2 className=\"text-lg font-bold text-gray-800 flex items-center gap-2\">\n          <svg className=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\"></path>\n          </svg>\n          Saved Properties\n        </h2>\n        <p className=\"text-xs text-gray-500 mt-1\">Organized by category</p>\n      </div>\n      \n      <div className=\"flex-1 overflow-y-auto p-4\">\n        {Object.keys(groupedByCategory).length === 0 ? (\n          <div className=\"text-center py-8\">\n            <svg className=\"w-16 h-16 mx-auto text-gray-300 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path>\n            </svg>\n            <p className=\"text-gray-500 text-sm\">No properties saved yet</p>\n          </div>\n        ) : (\n          Object.entries(groupedByCategory).map(([category, props]) => (\n            <CategoryGroup\n              key={category}\n              category={category}\n              properties={props}\n              onSelectProperty={onSelectProperty}\n            />\n          ))\n        )}\n      </div>\n      \n      <div className=\"p-4 border-t space-y-2\">\n        <button\n          onClick={onRefresh}\n          className=\"w-full bg-blue-100 text-blue-700 py-2 px-4 rounded hover:bg-blue-200 transition text-sm flex items-center justify-center gap-2\"\n        >\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path>\n          </svg>\n          Refresh\n        </button>\n        <button\n          onClick={onClearAll}\n          className=\"w-full bg-red-100 text-red-700 py-2 px-4 rounded hover:bg-red-200 transition text-sm\"\n        >\n          Clear All History\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction CategoryGroup({ category, properties, onSelectProperty }: { category: string; properties: PropertyData[]; onSelectProperty: (id: string) => void }) {\n  const config = CATEGORIES[category] || CATEGORIES.other;\n  \n  return (\n    <div className=\"mb-4\">\n      <div className=\"flex items-center gap-2 p-2 bg-gray-50 rounded-lg mb-2\">\n        <div style={{ color: config.color }} dangerouslySetInnerHTML={{ __html: config.icon }} />\n        <span className=\"font-semibold text-gray-800 text-sm\">{config.name}</span>\n        <span className=\"ml-auto text-xs text-gray-500\">({properties.length})</span>\n      </div>\n      <div className=\"space-y-2 ml-2\">\n        {properties.map((prop) => (\n          <div\n            key={prop.id}\n            onClick={() => prop.id && onSelectProperty(prop.id)}\n            className=\"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition cursor-pointer border-l-2\"\n            style={{ borderColor: config.color }}\n          >\n            <h3 className=\"font-semibold text-xs text-gray-800 truncate\">\n              {prop.property_name || 'Untitled'}\n            </h3>\n            <p className=\"text-xs text-gray-600 truncate\">{prop.location || 'N/A'}</p>\n            <div className=\"flex justify-between items-center mt-1\">\n              <span className=\"text-sm font-bold\" style={{ color: config.color }}>\n                ${prop.price_usd ? parseFloat(prop.price_usd).toLocaleString() : 'N/A'}\n              </span>\n              <span className=\"text-xs bg-white px-2 py-0.5 rounded\">\n                {prop.property_type || 'N/A'}\n              </span>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction getCategoryFromUrl(url: string): string {\n  if (!url) return 'other';\n  const urlLower = url.toLowerCase();\n  \n  if (urlLower.includes('proyectos-nuevos')) return 'proyectos-nuevos';\n  if (urlLower.includes('venta-casas')) return 'venta-casas';\n  if (urlLower.includes('venta-apartamentos')) return 'venta-apartamentos';\n  if (urlLower.includes('coldwellbanker')) return 'venta-casas';\n  \n  return 'other';\n}\n\nconst CATEGORIES: Record<string, { name: string; icon: string; color: string }> = {\n  'proyectos-nuevos': {\n    name: 'New Projects',\n    icon: '<svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V8a2 2 0 00-2-2h-5L9 4H4zm7 5a1 1 0 00-2 0v1H8a1 1 0 000 2h1v1a1 1 0 002 0v-1h1a1 1 0 000-2h-1V9z\" clip-rule=\"evenodd\"></path></svg>',\n    color: '#8b5cf6'\n  },\n  'venta-casas': {\n    name: 'Houses for Sale',\n    icon: '<svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z\"></path></svg>',\n    color: '#10b981'\n  },\n  'venta-apartamentos': {\n    name: 'Apartments for Sale',\n    icon: '<svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z\" clip-rule=\"evenodd\"></path></svg>',\n    color: '#3b82f6'\n  },\n  'other': {\n    name: 'Other',\n    icon: '<svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clip-rule=\"evenodd\"></path></svg>',\n    color: '#6b7280'\n  }\n};
